<Window x:Class="ActormixerSanitizer.UI.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Actormixer Sanitizer" Height="450" Width="800"
        Closing="MainWindow_Closing">
    <Window.Resources>
		<Style x:Key="GraphicToCheckboxStyle" TargetType="{x:Type ToggleButton}">
			<Setter Property="Template">
				<Setter.Value>
					<ControlTemplate TargetType="{x:Type ToggleButton}">
						<Grid Background="Transparent" Width="28" Height="20"
                              VerticalAlignment="Center" HorizontalAlignment="Center">

							<!-- The visual for the CHECKED state: a default CheckBox -->
							<CheckBox x:Name="CheckedVisual"
                                      IsChecked="True"
                                      IsHitTestVisible="False"
                                      Visibility="Collapsed"
                                      VerticalAlignment="Center"
                                      HorizontalAlignment="Center"/>

							<!-- The visual for the UNCHECKED state: the image -->
							<Image x:Name="UncheckedVisual"
                                   Source="ObjectIcons_ActorMixer_nor.png"
								   HorizontalAlignment="Left"
                                   Visibility="Visible"/>
						</Grid>
						<ControlTemplate.Triggers>
							<Trigger Property="IsChecked" Value="True">
								<Setter TargetName="CheckedVisual" Property="Visibility" Value="Visible" />
								<Setter TargetName="UncheckedVisual" Property="Visibility" Value="Collapsed" />
							</Trigger>
						</ControlTemplate.Triggers>
					</ControlTemplate>
				</Setter.Value>
			</Setter>
		</Style>
	</Window.Resources>
	<Grid Margin="10">
		<Grid.RowDefinitions>
			<RowDefinition Height="Auto"/>
			<RowDefinition Height="2*"/>
			<RowDefinition Height="5"/>
			<RowDefinition Height="*"/>
			<RowDefinition Height="Auto"/>
		</Grid.RowDefinitions>

		<StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,10">
			<Button Command="{Binding ConnectCommand}"
					Width="60" Margin="0,0,10,0" IsEnabled="{Binding IsNotConnected}"
					ToolTip="Connect">
				<Image Source="{Binding ConnectIcon}" Width="32" Height="32" />
			</Button>
			<Button Command="{Binding ScanCommand}"
					Width="60" Margin="0,0,10,0"
					ToolTip="Scan">
				<Image Source="{Binding ScanIcon}" Width="32" Height="32" />
			</Button>
			<Button Command="{Binding SelectAllCommand}"
					Width="60" Margin="0,0,10,0"
					ToolTip="Select All">
				<Image Source="{Binding SelectAllIcon}" Width="32" Height="32" />
			</Button>
			<Button Command="{Binding SelectNoneCommand}"
					Width="60" Margin="0,0,10,0"
					ToolTip="Select None">
				<Image Source="{Binding SelectNoneIcon}" Width="32" Height="32" />
			</Button>
			<Button Command="{Binding ToggleSelectedCommand}"
					CommandParameter="{Binding ElementName=ActorMixerListBox, Path=SelectedItems}"
					Width="60" Margin="0,0,10,0"
					ToolTip="Toggle Selected">
				<Image Source="{Binding ToggleSelectedIcon}" Width="32" Height="32" />
			</Button>
			<Button Command="{Binding ShowSelectedListCommand}"
					Width="60" Margin="0,0,10,0"
					ToolTip="Show Selected List">
				<Image Source="{Binding ShowSelectedListIcon}" Width="32" Height="32" />
			</Button>
			<Button Grid.Row="4" Command="{Binding ConvertCommand}"
				Width="60" Margin="0,0,10,0"
				HorizontalAlignment="Right"
				ToolTip="Convert Selected to Folders">
				<Image Source="{Binding ConvertIcon}" Width="32" Height="32"/>
			</Button>
			<Button Grid.Row="4" Command="{Binding ThemeChangeCommand}"
				Width="60" Margin="0,0,10,0"
				HorizontalAlignment="Right"
				ToolTip="Change app theme">
				<Image Source="{Binding ThemeIcon}" Width="32" Height="32"/>
			</Button>
		</StackPanel>
		<!-- Replaced DataGrid with ListBox using solution 2: bind ListBoxItem.IsSelected to item.IsSelected -->
		<ListBox Grid.Row="1"
                 Name="ActorMixerListBox"
                 ItemsSource="{Binding ActorMixers}"
                 SelectionMode="Extended"
                 HorizontalContentAlignment="Stretch"
                 BorderThickness="0"
                 Background="Transparent">
			<ListBox.ItemContainerStyle>
				<Style TargetType="ListBoxItem">
					<!-- Keep ListBox selection and the item's IsSelected property synchronized 
                    <Setter Property="IsSelected" Value="{Binding IsSelected, Mode=TwoWay}"/> -->
					<!-- TODO: Errors in calls -->
					<!-- TODO: Mem leak -->
					<!-- TODO: Refactor logging -->
					<!-- TODO: New state check for 2024+ -->
					<!-- TODO: Add Tests -->
					<!-- TODO: Icons and shipit -->
                    <!-- TODO: Get info on Connect. Subscribe for additional topics and undo -->

                    <!-- Double-click will toggle the checkmark -->
					<EventSetter Event="MouseDoubleClick" Handler="ListBoxItem_MouseDoubleClick"/>

					<Setter Property="Tag" Value="{Binding DataContext, ElementName=ActorMixerListBox}"/>
					<Setter Property="ContextMenu">
						<Setter.Value>
							<ContextMenu>
								<MenuItem Header="{Binding Name}" IsEnabled="False"/>
								<Separator/>
								<MenuItem Header="Copy name" Command="{Binding PlacementTarget.Tag.CopyNameCommand, RelativeSource={RelativeSource AncestorType=ContextMenu}}" CommandParameter="{Binding}"/>
								<MenuItem Header="Copy id" Command="{Binding PlacementTarget.Tag.CopyIdCommand, RelativeSource={RelativeSource AncestorType=ContextMenu}}" CommandParameter="{Binding}"/>
								<MenuItem Header="Copy path" Command="{Binding PlacementTarget.Tag.CopyPathCommand, RelativeSource={RelativeSource AncestorType=ContextMenu}}" CommandParameter="{Binding}"/>
								<MenuItem Header="Select in Wwise" Command="{Binding PlacementTarget.Tag.SelectInWwiseCommand, RelativeSource={RelativeSource AncestorType=ContextMenu}}" CommandParameter="{Binding}"/>
							</ContextMenu>
						</Setter.Value>
					</Setter>
				</Style>
			</ListBox.ItemContainerStyle>

			<ListBox.ItemTemplate>
				<DataTemplate>
					<Border Padding="2" Margin="2" BorderBrush="LightGray" BorderThickness="0,0,0,0">
						<DockPanel>
							<ToggleButton DockPanel.Dock="Left"
                                          IsChecked="{Binding IsSelected, Mode=TwoWay}"
                                          Margin="0,0,0,0"
                                          Style="{StaticResource GraphicToCheckboxStyle}"/>
							<StackPanel>
								<TextBlock Text="{Binding Name}" FontWeight="SemiBold"/>
								<TextBlock Text="{Binding Path}" FontSize="12" Foreground="Gray"/>
							</StackPanel>
						</DockPanel>
					</Border>
				</DataTemplate>
			</ListBox.ItemTemplate>

		</ListBox>

		<GridSplitter Grid.Row="2" Background="Transparent" HorizontalAlignment="Stretch" ShowsPreview="True"/>

		<TextBox Grid.Row="3" Text="{Binding LogText, Mode=OneWay}"
                 IsReadOnly="True" TextWrapping="Wrap"
                 VerticalScrollBarVisibility="Auto"/>
	</Grid>
</Window>